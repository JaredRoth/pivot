<div class="container">
  <div class="cart-top">
    <h4><%= link_to "<< home", root_path %></h4>
  </div>
  <div class="">
  <h2>My Basket</h2>
  <h4>Contents: <%= @cart.count_donations %> Items</h4>
  <table class="table table-striped sized-table">
    <tr>
      <th>Amount</th>
      <th>Person in Need</th>
      <th>Need Fulfilled</th>
      <th>Update</th>
      <th>Remove</th>
    </tr>
    <% @recipients_donations.each do |recipient, donations| %>
    <div class="cart-header">
      <div class="cart-sec">
        <div class="cart-need-info">
      <% donations.each do |donation| %>
    <tr>

      <td>
        <h4><%= "Donate #{number_to_currency(donation.amount)}" %></h4>
      </td>

      <td>
        <h4><%= recipient.full_name %></h4>
      </td>

      <td><h4><%= donation.need_name %></h4></td>


      <td>
        <div class="col-xs-3">
        <%#= form_for :session, url: cart_path(:id, {need_id: need.id}), html: {method: "patch"} do |f| %>
          <%#= f.number_field :quantity, size: 2, value: need.quantity, min: 1, max: need.max, class: "form-control input-small" %>
          <h4>update form</h4>
          <button type="button" name="button" class="btn btn-default">Update (Broken)</button>
          <%#= f.submit "Update Quantity", class:"btn btn-default cart-update" %>
        </div>
        <td><h4><div class="cart-remove"><%= button_to "Remove Donation", donations_path(id: donation.id),  class: "btn btn-default", method: :delete, data: { confirm: "Are you sure?" } %></div></h4></td>
          <% end %>
        <% end %>
      </td>

    </table>
  </div>
</div>
<center>
  <a name="about"></a>
  <div class="intro-header">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="splash">
            <div class="">
              <h3 class="last-price">TOTAL
                <%= number_to_currency(@cart.total_donor_cost) %></h3>
              <hr class="intro-divider">

              <ul class="fluff list-inline intro-social-buttons">
                <li>
                  <div class="clearfix"></div>
                  <%if current_user %>
                    <% if @cart.contents["donor"].empty? %>
                      
                    <% else %>

                    <%= form_tag charges_path do %>
                      <article>
                      <% if flash[:error].present? %>
                        <div id="error_explanation">
                          <p><%= flash[:error] %></p>
                        </div>
                      <% end %>
                      <label class="amount">

                      </label>
                      </article>

                      <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                        data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                        data-description="Goats and Soda"
                        data-amount="<%= @cart.total_donor_cost * 100 %>"
                        data-locale="auto"
                        data-label="Checkout"
                        data-allow-remember-me=false
                        ></script>
                    <% end %>


                    <% end %>
                  <% else %>
                    <%= button_to "Login to Donate", login_path, method: :get, class:"btn btn-primary" %>
                  <% end %>
                </div>

                </li>
              </ul>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <center>
